# 25.MCP介绍

在之前的学习中，我们已经掌握了如何让 AI 调用工具（Tool Calling）。

它本质上解决的是“如何让模型结构化地调用外部能力”的问题。但当系统开始变复杂后，问题就会暴露出来。

## 工具调用的问题

如果做过稍微复杂一点的 Agent 项目，基本都会踩到这些坑。

### 1. 工具强绑定模型，架构耦合严重

常见工程现状是：

- 每个 Agent 自己注册一堆工具
- 每个框架（LangChain / AutoGen / CrewAI）一套 Tool Schema
- 同一个工具要适配 OpenAI / Claude / 本地模型写多套代码

例如一个「查订单 + 改库存 + 发通知」的能力：

- 在 LangChain 里写一套 Tool
- 在 AutoGen 里重写一套
- 换模型，又要调一轮参数格式和返回结构

结果往往是：

- 工具几乎不可复用
- Agent 被框架锁死
- 模型一换，工程大改

工具调用更像“私有接口”，不是“公共能力层”。

### 2. 工具越来越多，Prompt 变成垃圾场

随着能力增长，工具 10 个 → 30 个 → 100 个，每个工具都要写描述、参数说明、示例

最终变成：

- Prompt 极长
- Token 成本爆炸
- 模型选错工具
- 推理不稳定

### 3. 缺乏上下文边界和安全隔离

在纯 Tool Calling 架构下，很难优雅解决：

- 读权限 / 写权限 / 危险操作混在一起
- 用户输入 / 系统指令 / 工具返回堆在一个 Prompt
- 无法统一做审计、限流、沙箱、监控

例如：

- 一个查询类 Agent，理论上不应该具备“删库 / 发消息”的能力
- 但在很多实现里，它们只是 Prompt 里的两段描述

这使得 Agent很难进入真正生产环境。

为了解决上述问题，Anthropic 推出的全新行业标准——MCP（Model Context Protocol，模型上下文协议）。

## 什么是 MCP

**MCP (Model Context Protocol)** 是一种开放标准，它改变了 AI 模型与数据源之间的交互方式。

如果类比软件历史：

- Tool Calling ≈ 函数调用
- MCP ≈ 操作系统接口 + 网络协议

也可以把它理解为 AI 世界的 **“USB 接口”**。

在 USB 出现前：

- 打印机一个口
- 键盘一个口
- 摄像头一个口

有了 USB：

- 只要符合协议，都能即插即用

而有了MCP之后，只要能力实现成 MCP Server，任何支持 MCP 的模型或 Agent 都可以直接使用。

### MCP 的核心架构

MCP 采用标准的 Client–Server 架构，主要包含三个角色：

**1. MCP Host**

运行模型和 Agent 的环境。

例如：

- Claude Desktop
- Cursor
- 你自己的 Agent 平台
- 企业内部 AI 系统

**2. MCP Client**

Host 内部的协议模块，负责：

- 发现 MCP Server
- 建立安全连接
- 管理上下文交互

它是 AI 世界的“网卡 + 驱动”。

**3. MCP Server**

真正承载能力的独立服务。

例如：

- 文件系统 MCP Server
- 数据库 MCP Server
- GitHub MCP Server
- 内部系统 MCP Server

它们不属于某个 Agent，而是**系统能力节点**。

### MCP 的三大核心功能

通过 MCP，Server 可以向 AI 提供三种主要能力：

| 功能                  | 说明                                         | 例子                                   |
| ------------------- | ------------------------------------------ | ------------------------------------ |
| **Resources (资源)**  | 允许 AI **读取**数据。类似于文件的只读访问。                 | 读取一份 `.md` 文档或数据库的内容。                |
| **Tools (工具)**      | 允许 AI **执行**操作。这是我们熟悉的 Tool Calling 的标准化版。 | 在 GitHub 上创建一个 Issue，或发送一条 Slack 消息。 |
| **Prompts (提示词模板)** | 预设的对话指令。                                   | 提供一个“代码审查”或“撰写周报”的固定模板。              |

## 4. MCP的工程价值

* **一次编写，到处运行**：如果你开发了一个接入自研数据库的 MCP Server，它不仅能在你的应用里用，还能直接被 Claude Desktop 或其他支持 MCP 的 IDE 识别。
* **隐私与安全**：数据源不再需要直接暴露给云端模型。MCP Server 运行在你的本地或私有环境中，只有经过处理的上下文会被发送给 AI。
* **生态互联**：目前已经有大量现成的 MCP Server（如访问本地文件、Google Search、PostgreSQL、GitHub 等），你可以像安装插件一样快速扩展 AI 的能力。
